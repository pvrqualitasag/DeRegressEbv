---
output:
  pdf_document:
    includes:
      in_header: tex/header.tex
  word_document: default
bibliography: DeRegressEbvSummaryGTF2009.bibtex  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = 'asis')

```


![Qualitas Logo](png/QualitasLogo.png)

\fcolorbox{black}{white}{
	\parbox[t]{1.0\linewidth}{
		\centering \fontsize{12pt}{20pt}\selectfont % 
		\vspace*{0.5cm} % 

		\hfill Zusammenfassung

		\vspace*{0.5cm} 
	}
}

\vspace*{0.5cm}

\fcolorbox{black}{white}{
	\parbox[t]{1.0\linewidth}{
		\centering \fontsize{25pt}{40pt}\selectfont %
		\vspace*{0.7cm}
    De-Regression von geschätzen    \\
    Zuchtwerten nach dem Paper  \\
    von GTF2009    \\

		\vspace*{0.7cm} % Space between the end of the title and the bottom of the grey box
	}
}

\vspace*{1cm}

\begin{center}
\includegraphics[width=0.5\textwidth]{png/Pedigree.png}
\end{center}

\vspace{5ex}
{\centering \small
\hfill
\begin{tabular}{l}
Peter von Rohr                      \\
FB EDV, Qualitas AG                 \\
\verb+http://www.qualitasag.ch+     \\
\verb+peter.vonrohr@qualitasag.ch+  
\end{tabular}
}

\pagebreak

\tableofcontents

\pagebreak

# Dokumentenstatus



```{r DocuStatusTable}
robjDocuStatus <- rqudocuhelper::refObjTable$new()
pvecTableHeader <- c("Version",
                     "Datum",
                     "Wer",
                     "Änderung")
robjDocuStatus$setTableHeader(psTableHeader = pvecTableHeader)
robjDocuStatus$addRow(plTableRow = list(Version = "0.0.0.900",
                                        Date    = "",
                                        Who     = Sys.info()[["user"]],
                                        Change  = "Erstellung"))
robjDocuStatus$addRow(plTableRow = list(Version = "0.0.0.901",
                                        Date    = "16.03.2016",
                                        Who     = Sys.info()[["user"]],
                                        Change  = "Ideales Modell, Zuchtwert-Modell"))
#robjDocuStatus$addRow(plTableRow = list(Version = "0.0.0.902",
#                                        Date    = "",
#                                        Who     = Sys.info()[["user"]],
#                                        Change  = ""))
robjDocuStatus$to_pander_pandoc(psStyle = "grid",
                                psJustify = rep("left", length(pvecTableHeader)),
                                pnSplitCells = c(10,15,5,40))

```

\pagebreak

# Abkürzungen

```{r AbrTable}
robjAbrTable <- rqudocuhelper::refObjTable$new()
pvecTableHeader <- c("Abkürzung",
                     "Bedeutung")
robjAbrTable$setTableHeader(psTableHeader = pvecTableHeader)
robjAbrTable$addRow(plTableRow = list(Abr = "Abk",
                                      What = "Abkürzung"))
#robjAbrTable$addRow(plTableRow = list(Abr = "",
#                                      What = ""))
robjAbrTable$to_pander_pandoc(psStyle = "grid",
                              psJustify = rep("left", length(pvecTableHeader)),
                              pnSplitCells = c(20,60))
```

\pagebreak


# Erklärung
Dieses Dokument gibt eine Zusammenfassung vom Paper von @GTF2009. Der Fokus der Zusammenfassung liegt auf dem Abschnitt der Deregression von geschätzten Zuchtwerten (EBV), dies deshalb, weil wir dafür ein direktes Interesse für eine Anwendung haben. Die anderen Abschnitte insbesondere das Material zum Hintergrund des Papers werden hier kurz gehalten oder ganz ausgelassen. 

In runden Klammern () werden die ursprünglichen englischen Begriffe aufgeführt, wo immer dies sinnvoll erscheint. Die geschweiften Klammern {}  enthalten zusätzliche erklärende Informationen, welche nicht im Paper sind. 


# Hintergrund (Background)
Genomische Effektschätzung (Genomic prediction) verwendet geschätzte Regressionskoeffizienten von Leistungsdaten auf Genotypen einer dichten Markerkarte aus einer Trainingspopulation für die Vorhersage der genomischen Zuchtwerte in einer Zielpopulation. In der Trainingspopulation befinden sich genotypisierte Tiere mit sehr unterschiedlichen Informationen, wie z. Bsp. wiederholte Messungen, Nachkommeninformationen oder traditionell geschätzte Zuchtwerte. 

In der Literatur gibt es keine einhellige Meinung, wie die verschiedenen Informationsquellen behandelt werden sollten. {Der Überblick im Paper über die verschiedenen Arten, wie die Informationen berücksichtigt werden, wird hier nicht angeführt}


Die Effektschätzung in der genomischen Selektion ist abhängig davon, welche 
Daten als abhängige Beobachtungen verwendet werden. 


# Methoden (Methods)
## Ein ideales Modell
Idealerweise hätten wir für das Training wahre genotypische Werte ($g$) von unverwandte Individuen ohne Selektion. Dann würde das Modell so aussehen

\begin{equation}
\mathbf{g} = \mathbf{1}\mu + \mathbf{M}\mathbf{a} + \mathbf{\epsilon}
\label{eq:IdealModel}
\end{equation}

wobei: $\mathbf{g}$ dem Vektor mit wahren Zuchtwerten mit $var(\mathbf{g}) = \mathbf{T}\sigma^2_g$ entspricht und das Skalar $\sigma^2_g$ die genetische Varianz darstellt, wobei $\mathbf{T}$ aufgrund der Theorie zu Kopplung und Kopplungsungleichgewicht aufgestellt werden kann. Die Grösse $\mu$ stellt das Intercept dar. Die Inzidenz-Matrix $\mathbf{M}$ verbindet die Genotypen in $\mathbf{g}$ mit den entsprechenden Substitutionseffekten in $\mathbf{a}$. Die Varianz $var(\mathbf{M}\mathbf{a}) = \mathbf{G}\sigma^2_M$, wobei $\mathbf{G}$ der genomischen Verwandtschaftsmatrix entspricht. Der Vektor $\mathbf{\epsilon}$ steht für die Residuen mit $var(\mathbf{\epsilon}) = \mathbf{E}\sigma^2_{\epsilon}$.   

{Die Diskussion, welche Effekte vom Modell in Gleichung (\ref{eq:IdealModel}) zufällig oder fix sind, und ob ein polygener Effekt im Modell mit berücksichtigt werden soll, wird hier nicht im Detail ausgeführt. Die Autoren stellen fest, dass es kaum möglich sein wird, dass die Summe aller Markereffekte die gesamte genetische Varianz erklären kann. Somit wird ein gewisser polygener Anteil im Effekt $\mathbf{\epsilon}$ zu finden sein. Da die Individuen im Training-Set aber verwandt sind miteinander, können die $\mathbf{\epsilon}$ Effekte nicht als unkorreliert modelliert werden. Als Folge davon entspricht die Matrix $\mathbf{E}$ nicht der Einheitsmatrix, sonder wird durch die additive genetische Verwandtschaftsmatrix $\mathbf{A}$ approximiert. Alternativ zur Verwendung von $\mathbf{A}$ können auch explizit korrelierte Residuen gefittet werden. 

Die zufälligen Effekte ($g$, $M$ und $\epsilon$) des Modells in Gleichung (\ref{eq:IdealModel}) werden als unkorreliert angenommen. Daraus folgt, dass $\sigma^2_g = \sigma^2_M + \sigma^2_{\epsilon}$. Der Anteil der genetischen Varianz, welche nicht von den Markern erklärt wird ist somit

$$c = \frac{\sigma^2_{\epsilon}}{\sigma^2_g} = 1 - \frac{\sigma^2_M}{\sigma^2_g}$$

Die Abschnitte zu den Modellen mit phänotypischen Records, wiederholten Messungen und mit den Nachkommendurchschnitten werden hier vorerst nicht behandelt.}


## Geschätzte Zuchtwerte als Trainingsdaten
Mit BLUP geschätzte Zuchtwerte können als Summe des wahren Zuchtwertes plus ein Schätzfehler (prediction error) betrachtet werden. Als Formel heisst das $\hat{\mathbf{g}} = \mathbf{g} + (\hat{\mathbf{g}} - \mathbf{g})$. Setzt man diese Beziehung in Gleichung (\ref{eq:IdealModel}) ein, dann folgt

\begin{equation}
\hat{\mathbf{g}} = \mathbf{g} + (\hat{\mathbf{g}} - \mathbf{g}) 
  = \mathbf{1}\mu + \mathbf{M}\mathbf{a} + (\mathbf{\epsilon} + (\hat{\mathbf{g}} - \mathbf{g}))
\label{eq:EbvModel}
\end{equation}

{Gleichung (\ref{eq:EbvModel}) hier in der Zusammenfassung entspricht Gleichung (8) im Paper.}

Die Verwendung von geschätzten Zuchtwerten für die Effektschätzung führt zu mindestens zwei Problemen, welche beide mit den Eigenschaften von BLUP-Schätzern zusammenhängen. Das erste Problem ist, dass die Addition des Schätzfehlers in Gleichung (\ref{eq:EbvModel}) dazu führt, dass die Varianz reduziert und nicht erhöht wird, obwohl die Diagonalelemente von 
$var(\hat{\mathbf{g}} - \mathbf{g})$ positiv sein muss. 

{Was hier nicht von Bedeutung ist, aber im Paper erwähnt wird, dass bei der Verwendung von phänotypischen Beobachtungen $y_i$ die Varianz steigt, da im Vergleich zum idealen Modell eine nicht genetische Komponente hinzukommt. Als Formel heisst das, dass $var(g_i) > var(\hat{g}_i)$, während $var(g_i) < var(y_i)$, was durch die Schrumpfung (shrinkage) der BLUP-Schätzung verursacht wird.}

Im allgemeinen ist die Varianz einer Differenz wie folgt definiert: $var(\hat{g}_i - g_i) = var(g_i) + var(\hat{g}_i) - 2cov(\hat{g}_i, g_i)$. Aber für BLUP gilt $cov(\hat{g}_i, g_i) = var(\hat{g}_i)$ und somit ist $var(\hat{g}_i - g_i) = var(g_i) - var(\hat{g}_i)$ und somit ist $var(g_i) > var(\hat{g}_i)$. 




\pagebreak

# References
